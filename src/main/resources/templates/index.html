<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<head>
    <meta charset="UTF-8">
    <title>Liftable</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Custom Styling to Match dpm.lol */
        body {
            background-color: #0e0e10;
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
        }

        .navbar {
            background-color: #0e0e10;
            padding: 5px 0px;
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fff;
        }

        .search-bar {
            max-width: 300px;
        }

        .form-control {
            background-color: #25252a;
            border: none;
            color: #fff;
        }

        .form-control::placeholder {
            color: #a1a1a1;
        }

        .btn-primary {
            background-color: #501993;
            border: none;
        }

        .btn-primary:hover {
            background-color: #772ce8;
        }

        .card, .card-body {
            background-color: #18181b;
        }

        .card {
            box-shadow: 0px 0px 5px rgba(141, 67, 232, 0.5);
        }

        .results-card {
            background-color: #18181b;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0px 0px 5px rgba(141, 67, 232, 0.5);
        }

        .list-group-item {
            background-color: #25252a;
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 5px;
            cursor: pointer;
        }

        .logo {
            width: 50px;
        }

        .gradient-navbar {
            margin-top: 56px;
            background: linear-gradient(to bottom, rgba(14, 14, 16, 1), rgba(14, 14, 16, 0));
            width: 100%;
            height: 30px;
        }

        .button {
            background-color: #28282e;
            color: #34343e;
            border: none;
        }

        .button-wrapper {
            background-color: #28282e;
        }

        .button-wrapper:hover {
            cursor: pointer;
        }

        .button-wrapper:first-of-type {
            border-radius: 25px 0px 0px 0px;
        }

        .button-wrapper:last-of-type {
            border-radius: 0px 25px 0px 0px;
        }

        .active + .button-wrapper {
            border-radius: 0px 0px 0px 10px;
        }

        .button-wrapper:has(+ .active) {
            border-radius: 0px 0px 10px 0px;
        }

        .active + .button-wrapper:last-of-type {
            border-radius: 0px 25px 0px 10px;
        }

        .button-wrapper:first-of-type:has(+ .active) {
            border-radius: 25px 0px 10px 0px;
        }

        .table-wrapper {
            padding: 0;
            margin: 0;
        }

        th, td {
            background-color: #18181b;
            border: none;
            color: white;
            text-align: center;
            font-size: 12px;
        }

        th, tr > td:first-child {
            text-align: start;
        }

        .active {
            background-color: #18181b;
            color: white;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Main Content Grid -->
<div class="container-fluid">
    <div class="row">
        <div class="col-12" style="height: 100px;"></div>
        <!-- First Row: Search, Lifter Info, Lifter Info JSON (Stacked vertically in one column) -->
        <div class="col-12">
            <div class="row">
                <div class="col-12">
                    <div id="resultsContainer"></div>
                </div>
                <div class="col-12">
                    <div th:replace="~{fragments/lifter-card :: lifter-card}"></div>
                </div>
                <div class="col-12">
                    <div th:replace="~{fragments/lifter-info-json :: lifter-info-json}"></div>
                </div>
            </div>
        </div>

        <!-- Second Row: Showdown on the left and Regional Rankings on the right -->
        <div class="col-12 d-flex justify-content-between">
            <div class="col-md-6 px-5">
                <div th:replace="~{fragments/showdown :: showdown}"></div>
            </div>
            <div class="col-md-6 px-5">
                <div th:replace="~{fragments/regional-rankings :: regional-rankings}"></div>
            </div>
        </div>

        <div class="col-12" style="height: 200px;"></div>

    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    function performSearch(searchBoxId, resultContainerId, endpoint) {
        let query = document.getElementById(searchBoxId).value;
        if (!query.trim()) return;

        fetch(`${endpoint}?query=${query}`)
            .then(response => response.text())
            .then(html => {
                let container = document.getElementById(resultContainerId);
                if (!container) {
                    return;
                }

                // Replace href links with onclick
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;

                let resCard = tempDiv.getElementsByClassName('results-card')[0];

                if (endpoint.toLowerCase().includes('showdown')) {
                    resCard.classList.remove('w-25');
                    resCard.classList.add('w-100');
                }

                const links = tempDiv.querySelectorAll('a');
                links.forEach(link => {
                    // Get the href value and extract the part after the slash
                    const href = link.getAttribute('href');
                    const name = href.split('/')[1];  // Get everything after the slash

                    link.setAttribute('onclick', `populateInfo('${name}', '${resultContainerId}', '${endpoint}')`);
                    link.removeAttribute('href');  // Optionally remove the href attribute
                });

                container.innerHTML = tempDiv.innerHTML;
            })
            .catch(error => console.error('Error fetching search results:', error));
    }

    function populateInfo(name, resultContainerId, endpoint) {
        fetch(`${endpoint}/lifter/${name}`)  // Fixed the template literal usage here
            .then(response => response.text())
            .then(html => {
                let container = document.getElementById(resultContainerId);
                if (!container) {
                    console.error("Container not found:", resultContainerId);
                    return;
                }

                // Replace href links with onclick
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;

                var resCard = tempDiv.getElementsByClassName('results-card')[0];

                if (endpoint.toLowerCase().includes('showdown')) {
                    resCard.classList.remove('w-25');
                    resCard.classList.add('w-100');
                    resCard.getElementsByTagName('table')[0].classList.add('table-sm');
                }

                container.innerHTML = tempDiv.innerHTML;  // Fixed typo from innerHtml to innerHTML
            })
            .catch(error => console.error('Error fetching lifter info:', error));  // Fixed the error log typo
    }

    document.addEventListener("DOMContentLoaded", function () {
        const buttons = document.querySelectorAll(".button");
        const butWraps = document.querySelectorAll(".button-wrapper");
        const tables = document.querySelectorAll(".table-wrapper");

        butWraps.forEach((butWrap, index) => {
            butWrap.addEventListener("click", function () {
                butWraps.forEach(btn => btn.classList.remove("active"));
                butWraps.forEach(btn => btn.children[1].classList.remove("active"));
                tables.forEach(tbl => tbl.classList.add("hidden"));

                butWrap.classList.add("active");
                butWrap.children[1].classList.add("active");
                tables[index].classList.remove("hidden");
            });
        });
    });
</script>

</body>
</html>
